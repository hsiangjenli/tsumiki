---
mode: agent
description: 釐清指定任務的 TDD 需求背景，為後續測試與實作整理完整脈絡
inputs:
  summary: 透過本 Prompt 蒐集需求來源並定義 TDD 工作邊界
  required:
    - 目標 TDD Issue（或草稿）的編號與標題
    - 對應的需求 / BDD / SDD Issue 連結（使用 `#編號` 格式）
    - 可用的設計或程式文件路徑（architecture.md、interfaces.ts 等）
    - 已知的技術限制、CI/CD 約束與時程目標
    - 語言與輸出格式偏好（預設繁體中文 + Markdown）
outputs:
  summary: 匯整 `tdd.md` 模板「來源與範圍」所需資訊，並列出後續要補的細節
  include:
    - 功能概要、主要使用者與價值（EARS / 使用者故事交叉驗證，對推測或待確認的內容標註 🟡／🔴）
    - 輸入輸出、非功能限制、預期情境（引用既有資料時附上 `#編號`，僅對尚未確認的內容標註 🟡／🔴）
    - BDD Scenario ↔ TDD 驗證項目的映射草稿（Scenario ID、對應測試範圍、建議欄位）
    - 建議寫入 TDD Issue 的欄位（可直接貼上，標示來源 `#編號` 與待確認事項）
    - 待確認事項、需轉回 `requirements-change` 的條件與建議切換到 `tdd-testcases.prompt.md` 的時機
---

# tdd-requirements

## 目的

在進入測試案例與實作前，先用 TDD 角度整理需求背景、輸入輸出與限制條件，確保後續步驟有完整脈絡可用於 `TDD 測試與實作計畫` Issue。

## 流程

### Step 1：建立共識
1. 確認目標 TDD Issue 編號與標題，蒐集對應的需求、BDD、SDD Issue（使用 `#編號` 記錄）。
2. 整理相關文件：需求摘要、設計圖、現有程式或測試、系統規範。
3. 標記任務幅度矩陣（API、前端、資料處理、AI/ML、排程、資料庫、監控等），僅列出需要在本迭代處理的區塊。

### Step 2：界定範圍
1. 以封閉式問題確認主要使用者、目標場景、關鍵價值（EARS / 使用者故事交叉驗證）。
2. 梳理輸入／輸出、假設、相依條件，引用資料附 `#編號`，對未確認項目標註 🟡／🔴。
3. 紀錄非功能限制：效能、安全、相容性、部署、資料品質、模型限制等。
4. 將成功／失敗訊號、監控需求與 Scenario ID 建立初步映射，避免與 BDD 重複詢問。
5. 標註可能影響後續 `tdd-testcases` 的風險（例如資料樣本不足、環境無法模擬）。

### Step 3：整理輸出
1. 撰寫可貼入 TDD Issue 的「來源與範圍」段落，含功能概要、主要情境、輸入輸出與限制，並標示來源與狀態（🔵／🟡／🔴）。
2. 建立「Scenario ↔ TDD 驗證項目」草稿表：`Scenario ID | 驗證焦點 | 相關契約/資料 | 備註`，僅描述範圍，具體測試由 `tdd-testcases` 接手。
3. 列出待補資訊與外部依賴（項目、來源、責任人、預計時間），若有需求矛盾即標註 🔴，後續由 `tdd-checkpoint`／`tdd-verify` 再決策是否回圈。
4. 整理需同步到 BDD / SDD Issue 的更新項目（使用 `#編號`），提醒在輸出末尾註明。
5. 指出下一步應執行 `tdd-testcases.prompt.md`，並告知需攜帶的重點（例如優先場景、資料缺口）。
6. 提醒更新 TDD Issue：貼上輸出內容、勾選「迭代進度」的 `Requirements` 核取框、於評論標註待補事項。

## 產出格式建議

- **功能概要**：可直接貼到 Issue，引用資料附 `#編號`，對尚未確認的假設標註 🟡／🔴。
- **輸入 / 輸出對照表**：欄位、型別、來源與狀態（確定／待確認）。
- **限制條件列表**：分別列出效能、安全、資料、部署等。
- **情境摘要**：概述主要情境與邊界情境，供測試案例延伸。
- **Scenario 對照表**：`BDD-###`、預期測試範圍、對應 Issue `#編號`、狀態。
- **待確認事項**：列點，方便後續追蹤。

## 後續建議

- 完成需求整理後，切換至 `tdd-testcases.prompt.md` 擴充測試案例。
- 若需求變更，記得回寫到對應的 BDD / SDD Issue 並重跑本 Prompt。
- 若發現某 Scenario 缺少對應測試項目，先回到 `bdd.prompt.md` 或 `requirements-change.prompt.md` 補齊行為後再繼續。
- 在輸出末尾提醒使用者確認 TDD Issue 已更新最新背景資訊與迭代核取框。

## Issue 操作提醒

依 `_issue-ops-guide.md` 中的「TDD」指引更新或建立 Issue：貼上背景摘要與 Scenario 對照表、勾選 `Requirements` 核取框，並於評論紀錄待補事項與下一個子 Prompt。
