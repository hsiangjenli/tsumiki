---
mode: agent
description: 總驗證 TDD 迭代成果，確認測試、契約、品質檢查皆達標並回報結果
inputs:
  summary: 使用本 Prompt 進行 Verify / Complete 階段的檢查與回報
  required:
    - 目標 TDD Issue 與最新測試矩陣
    - Red / Green / Refactor 階段的輸出摘要與待辦
    - 必須通過的測試指令、CI/CD 流程與品質守門清單
    - 需要同步驗證的契約、文件、監控設定
    - 語言與輸出格式偏好（預設繁體中文 + Markdown）
outputs:
  summary: 出具驗證結果報告，判定是否結束 TDD 迭代或需重新循環
  include:
    - 驗證檢查清單（測試、品質、契約、文件、監控）的通過狀態、來源 `#編號` 與證據；對待確認項目標註 🟡／🔴
    - 契約 / 文件同步情況與缺口（含負責人、完成時程、來源，必要時標註 🟡／🔴）
    - 回圈判定決策樹：依檢查結果列出需返回的階段（Red / Green / Refactor / requirements-change / sdd），並說明觸發條件（測試失敗類型、品質缺口、契約偏差、需求偏移）
    - 建議後續動作：提交 PR、更新 Issue、建立新任務等（附來源與責任人）
---

# tdd-verify

## 目的

在完成 Red→Green→Refactor 後，執行最終驗證，確認所有測試與品質檢查通過、契約與文件同步更新，並決定是否結束本次 TDD 迭代或回到先前階段。

> 前述子流程（Red / Green / Refactor / 檢查點）僅需紀錄阻塞與疑慮，真正的回圈判定與需求調整決策在本階段一次完成，避免多處邏輯分散。

## 流程

### Step 1：建立檢查清單
1. 根據測試矩陣列出必須通過的測試與指令。
2. 列出需要覆蓋的品質守門（建議至少：Lint、型別、Coverage、靜態分析或資安掃描）。
3. 確認是否有契約、文件、監控設定需要同步驗證或更新。

### Step 2：逐項驗證
1. 依清單逐項執行測試與守門檢查，記錄結果與證據連結。
2. 契約、文件、監控若未同步，記錄缺口與責任人。
3. 對於未通過項目，標示類型：`Test Failure`、`品質檢查未過`、`契約/文件缺漏`、`需求偏移` 等。

### Step 3：判定與交接
1. 將檢查結果整理成表格，標記 ✅（通過）、⚠️（需跟進）、❌（未通過），附來源 `#編號` 與狀態（🔵／🟡／🔴）。
2. 若全部為 ✅，輸出驗證摘要、耗時與後續交付建議（提交 PR、部署、更新 changelog 等），並勾選 TDD Issue 的 `Verify` 核取框。
3. 若存在 ⚠️／❌，依下列原則建議回圈路徑：
   - 測試案例不足 → 回 `tdd-testcases`（必要時再進 `tdd-red`）。
   - 測試實作缺陷 → 回 `tdd-green`。
   - 品質檢查或重構待補 → 回 `tdd-refactor`。
   - 契約 / 文件不同步 → 回 `sdd` 或 `tdd-refactor`（針對文件）。
   - 需求偏移或情境需變更 → 建議啟動 `requirements-change`，並列出受影響 Scenario。
4. 更新 TDD Issue：貼上驗證表、說明建議路徑、同步測試矩陣狀態；若尚未結束，明確交代下一個子 Prompt 或需求變更動作。
5. 若決策為回圈，提醒在輸出末尾標註應通知的責任人與預計重新驗證時間；同時保留 ⚠️／🔴 標記供 `tdd-checkpoint` 參考。

## 產出格式建議

- **驗證結果表**：項目、指令 / 工具、結果、來源 `#編號`、狀態（✅/⚠️/❌）、備註。
- **契約 / 文件同步清單**：是否已更新、連結、待補事項、責任人、完成期限。
- **決策摘要**：明確標示狀態（`Ready for PR` / `Re-run Red` / `Re-run Green` / `Refactor Needed` / `Return to requirements-change` / `Update SDD`）與下一步。

## 後續建議

- 若需再次迭代，建議立即回到指定階段並更新 TDD Issue。
- 合格後，可啟動實作 PR 流程或進入更高層級測試。
- 在輸出末尾提醒使用者確認 TDD Issue 已留存完整驗證記錄，並附上使用的證據來源；對需跟進的項目標註 ⚠️（含 🟡／🔴 說明）。

## Issue 操作提醒

依 `_issue-ops-guide.md` 的「TDD」指引：貼上驗證結果表、勾選 `Verify` 核取框，並於評論紀錄決策摘要與後續行動；若需回圈或新增任務，建立對應 Issue 後互相引用。
