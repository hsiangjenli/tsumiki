---
mode: agent
description: 依據 Red 階段的失敗測試進行實作，讓測試轉為綠燈並記錄過程
inputs:
  summary: 以本 Prompt 指導 Green 階段的實作與測試
  required:
    - 目標 TDD Issue 與最新測試矩陣（標示需轉綠的項目）
    - 對應的測試檔、失敗訊息與阻塞清單（來自 `tdd-red`）
    - 相關程式與合約位置（模組、API、資料處理、模型等）
    - CI/CD 或品質守門需求（Lint、型別檢查、靜態分析等）
    - 語言與輸出格式偏好（預設繁體中文 + Markdown）
outputs:
  summary: 記錄實作調整、測試結果與遇到的問題，將狀態更新為 Green
  include:
    - 實作重點與修改檔案摘要（含測試結果）
    - 連續錯誤追蹤表（欄位：`Test ID`、`測試檔/名稱`、`錯誤摘要(前120字)`、`錯誤分類`、`連續次數`、`處理狀態`、`來源/狀態`）；同一錯誤連續 3 次需透過 MCP 留言，5 次時依 README 規範調整標籤
    - 品質檢查項目（Lint、Type Check、依賴更新等）的執行紀錄與結果來源
    - 尚未解決的阻塞與建議下一步（Refactor 或 requirements-change）
---

# tdd-green

## 目的

根據 Red 階段製作的失敗測試，實作最小可行程式碼讓測試轉為綠燈，同時維持程式品質並記錄遇到的議題。

## 流程

### Step 1：確認目標
1. 回顧 Red 階段的測試與錯誤摘要，確認要轉綠的情境與輸入輸出。
2. 標記需要修改的模組或契約影響面，評估效能、安全、資料等限制。
3. 若仍懷疑需求／契約差異，將該測試標註為 🔴 並記錄依據，等待 `tdd-checkpoint`／`tdd-verify` 決策。

### Step 2：最小實作
1. 依最小可行原則修改程式碼或契約，一次專注一個情境。
2. 每次修改後執行對應測試並記錄命令與結果，確保測試由 Red 轉為 Green。
3. 按 README〈MCP 錯誤處理〉計算重複錯誤：同一測試錯誤連續 3 次需留言、5 次需調整標籤；僅記錄狀態並保留決策權給檢查點。
4. 在測試確實轉綠前不要進入下一個測試項目。

### Step 3：整理成果
1. 執行必要的守門檢查：Lint、型別檢查、靜態分析、依賴安全掃描等。
2. 將主要修改、測試輸出與守門結果整理成段落或表格，對未確認事項標註 🟡／🔴。
3. 將測試矩陣對應列標記為 Green，附上 CI 或本地輸出連結；勾選 TDD Issue 的 `Green` 核取框。
4. 列出仍待處理的技術債或阻塞，指定在 `tdd-refactor` 處理；若持續有需求疑慮，標註 🔴 供檢查點評估。
5. 提醒下一步執行 `tdd-refactor.prompt.md`，並攜帶上述阻塞與守門結果。

## 產出格式建議

- **變更摘要表**：檔案路徑、修改重點、對應情境、測試命令、來源或狀態（對未確認資訊標註 🟡／🔴）。
- **測試結果**：成功測試的截圖或重點輸出、CI 執行 URL（附來源說明）。
- **錯誤追蹤**：若有留言，附上連結或內容摘要，紀錄當前狀態（正常／待重試／🔴 需求疑慮）。
- **待辦事項**：列出需在 Refactor 階段或 PR 中處理的項目，含責任人與預計完成時間。

## 後續建議

- 若 Green 階段遇到需求不一致，回到 BDD / SDD Issue 重新對齊。
- 完成後立即啟動 `tdd-refactor.prompt.md`，確保品質提升。
- 在輸出結尾提醒使用者確認已於 TDD Issue 留言或更新狀態，並同步紀錄資料來源或狀態。

## Issue 操作提醒

依 `_issue-ops-guide.md` 的「TDD」指引：將測試矩陣更新為 Green、勾選迭代核取框，並於評論同步實作摘要與連續錯誤狀態；若另建待辦，請互相引用；若需新建 TDD Issue，標題務必使用 `[TDD] 模組／測試套件名稱 - 簡述`。
