---
mode: agent
---
---
description: 分析使用者提供的需求概要，並以 EARS（Easy Approach to Requirements Syntax）記法撰寫含詳細驗收標準的需求定義書。
---

# kairo-requirements

## 目的

蒐集與分析現有專案資訊，向使用者進行需求訪談，並使用 EARS 記法整理成含驗收標準的需求定義書。
提問時請採一問一答形式，提供選項與自由輸入的組合。

## 前提條件

- 專案已有程式碼或設計文件
- 存在 `docs/spec/` 目錄（若無請先建立）

## 執行流程

### Phase 0：全面蒐集既有專案資訊

**【信賴等級指引】**：
請針對每項資訊標示與原始資料（EARS 需求、設計文件、使用者訪談）的對照狀態：
- 🔵 **藍燈**：直接依據原始資料
- 🟡 **黃燈**：根據資料合理推測
- 🔴 **紅燈**：原始資料未提及

1. **讀取追加規範**
   - 讀取 `docs/rule`（若存在）
   - 讀取 `docs/rule/kairo`
   - 讀取 `docs/rule/kairo/requirements`

2. **蒐集專案基本資訊**
   - 讀取 `CLAUDE.md`（專案概要、技術堆疊、限制）
   - 讀取 `README.md`（若存在）
   - 確認專案目錄結構

3. **調查既有設計／規格文件**
   - 檢視 `docs/` 內所有設計文件
   - 讀取既有需求定義與設計文件
   - 檢視任務管理文件（例如 phase*.md）
   - 若有 API 規格或資料庫設計，請檢閱

4. **分析程式碼與開發狀況**
   - 使用 @agent-symbol-searcher 調查既有實作與規格
   - 透過 git status/log 瞭解進度
   - 疊對實作與設計的差異
   - 找出未完成或缺漏的任務

5. **整理蒐集結果**
   - 描述專案全貌
   - 標示已定義與未定義的需求
   - 彙整技術限制與非功能需求
   - 進行差距分析（設計 vs. 實作 vs. 使用者期待）

### Phase 1：根據既有資訊進行差異訪談

6. **確認既有設計的妥當性**
   - 詢問既有的功能／非功能需求是否仍適用
   - 確認現有限制（效能、資料等）是否仍成立
   - 檢視技術堆疊選擇是否需要調整
   - 找出現有設計難以實現或不適切之處

7. **釐清未定義或模糊部分**
   - 針對描述不清的功能進一步確認
   - 了解實際業務流程與使用情境
   - 確認輸入／輸出資料的細節
   - 確認 UI/UX 的期待值

8. **蒐集新增或變更需求**
   - 探詢既有設計未涵蓋的新需求
   - 確認外部系統整合需求
   - 確認報表／分析需求
   - 提問運維與維護需求

9. **確認對既有功能的影響範圍**
   - 了解新需求對既有功能的影響容忍度
   - 確認對效能需求的影響
   - 檢視對安全性／無障礙的影響
   - 確認資料移轉與相容需求

10. **調整優先順序與範圍**
   - 以 MoSCoW（Must/Should/Could/Won't）分類
   - 確認釋出範圍與分階段計畫
   - 依預算與時程重新排序

### Phase 2：撰寫整合需求定義書

11. **撰寫／更新使用者故事**
    - 以 WHO／WHAT／WHY 格式描述
    - 更新既有故事並新增缺漏
    - 標示功能價值與優先順序

12. **以 EARS 記法整理功能需求**
    - **通常需求（SHALL）**：系統應執行的行為
    - **條件式需求（WHEN/IF-THEN）**：特定條件下的行為
    - **狀態需求（WHERE）**：特定狀態下的行為
    - **可選需求（MAY）**：選擇性功能
    - **限制需求（MUST）**：系統必須遵守的限制
    - 與既有需求整合，排除重複並解決矛盾

13. **定義 Edge Case 與非功能需求**
    - 錯誤處理與例外流程
    - 邊界值與資料限制
    - 效能、安全、可用性需求
    - 運維、保守、移轉需求

14. **建立需求文件**
    - `docs/spec/{要件名}-requirements.md`：整合功能需求與相關連結
    - `docs/spec/{要件名}-user-stories.md`：詳細使用者故事
    - `docs/spec/{要件名}-acceptance-criteria.md`：驗收標準與測試項目
    - 明確記錄相較既有需求的新增與變動
    - 每項資訊均標示 🔵🟡🔴 信賴等級

## 輸出格式示例

### 1. requirements.md

```markdown
# {要件名} 要件定義書

## 概要
{需求概述}

## 相關文件
- **使用者故事**：[📖 {要件名}-user-stories.md]({要件名}-user-stories.md)
- **驗收標準**：[✅ {要件名}-acceptance-criteria.md]({要件名}-acceptance-criteria.md)

## 功能需求（EARS 記法）

**信賴等級：** 🔵 確定、🟡 推測、🔴 猜測

### 通常需求
- REQ-001：系統必須 {一般動作} 🔵 *引用來源*
- REQ-002：系統必須 {一般動作} 🟡 *推測來源*

### 條件式需求
- REQ-101：當 {條件} 時，系統必須 {動作} 🔵 *引用來源*

### 狀態需求
- REQ-201：處於 {狀態} 時系統必須 {動作} 🟡 *推測來源*

### 可選需求
- REQ-301：系統可以 {可選功能} 🔵 *引用來源*

### 限制需求
- REQ-401：系統必須符合 {限制事項} 🔵 *引用來源*

## 非功能需求

### 效能
- NFR-001：{效能需求} 🟡 *推測來源*

### 安全
- NFR-101：{安全需求} 🔵 *引用來源*

### 使用性
- NFR-201：{使用性需求} 🔴 *推測來源*

## Edge Case

### 錯誤處理
- EDGE-001：{錯誤情境} 🟡 *推測來源*

### 邊界值
- EDGE-101：{邊界情境} 🔵 *引用來源*
```

### 2. user-stories.md

```markdown
# {要件名} 使用者故事

## 概要
本文件描述 {要件名} 的詳細使用者故事。

## 使用者分類

### 主要使用者
- **終端使用者**：{說明}
- **管理者**：{說明}

### 次要使用者
- **系統管理者**：{說明}
- **外部系統**：{說明}

## 使用者故事

**信賴等級**：🔵 確定、🟡 推測、🔴 猜測

### 📚 史詩 1：{功能群組} 🔵 *引用來源*

#### 故事 1.1：{故事名稱} 🔵 *引用來源*

**故事描述**：
- **身為** {使用者種類}
- **我希望在** {情境／脈絡}
- **能夠** {想達成的行為}
- **以便** {獲得的價值}

**詳細說明**：
- **背景**：{需求原因}
- **前提條件**：{必要情境}
- **使用場景**：{範例}
- **期待體驗**：{使用者期望}

**相關需求**：REQ-001, REQ-002
```

### 3. acceptance-criteria.md

```markdown
# {要件名} 驗收標準

## 概要
本文件列出 {要件名} 的驗收標準與測試觀點。

## 驗收標準

### 功能驗收
- AC-001：{驗收條件} 🔵 *引用來源*

### 錯誤處理
- AC-101：{錯誤條件} 🟡 *推測來源*

### 效能
- AC-201：{效能條件} 🔵 *引用來源*

### 安全
- AC-301：{安全條件} 🔵 *引用來源*

### 無障礙／UX
- AC-401：{使用性條件} 🟡 *推測來源*
```

## 文件產出與後續

1. 在 `docs/spec/` 建立上述三個檔案
2. 若已有同名檔案，請合併並標示更新處
3. 於任務紀錄中註明變更摘要與信賴等級
4. 將 TODO 更新為「需求定義完成」，並提示下一步驟

## 下一步建議

- 建議執行 `kairo-design` 產出設計文件
- 提醒使用者進一步確認需求

以上流程可確保需求資訊完整掌握並與既有資產一致。
