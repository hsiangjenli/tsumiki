---
mode: agent
description: 針對已存在的需求定義進行新增或修改，更新 EARS 與 GWT，並同步規劃 GitHub Issue / PR 行動
inputs:
  summary: 確認此次變更的來源、影響範圍與限制，避免與既有文件衝突
  required:
    - 變更依據的 GitHub Issue（編號與連結）或等效紀錄
    - 使用者提供的變更摘要（原因、期望成果、優先順序）
    - 相關文件與路徑（需求、驗收、設計、程式碼、CI/CD 等）
    - 受影響的時程、部署或流程限制
    - 語言與輸出格式偏好（預設繁體中文 + Markdown）
outputs:
  summary: 提供更新後的需求與驗收描述，並列出同步行動
  include:
    - 變更摘要與資料來源（含信賴等級與 Issue 連結）
    - 更新後的 EARS 條目（標記新增、修改、沿用）與對應 GWT 驗收描述
    - 影響分析：需更新的文件、程式碼、測試、CI/CD 項目
    - 建議建立或更新的 GitHub Issue／PR（標題、標籤、重點）與分支／Commit 範例
    - 後續建議 Prompt 與待確認事項，提醒將輸出留存於 GitHub Issue
---

# requirements-change

## 目的

當專案已經擁有需求文件，但使用者提出新增或調整時，協助辨識影響範圍、更新 EARS 需求與 GWT 驗收描述，並整理後續在 GitHub 上應採取的 Issue、PR 或文件更新步驟。

> **判定原則**：只要 `docs/spec/`、GitHub Issue / PR、或專案維運文件中已有可追溯的需求描述（例如 `*-requirements.md`、`requirements` 標籤 Issue），即視為「既有需求」。若判定為新需求，請改用 `requirements.prompt.md` 建立基準再回到本 Prompt。

## 前置條件

- `docs/spec/` 內已有既定需求文件或等效紀錄。
- 可參考 `CHANGELOG.md`、Git 歷史與相關 Issue／評論；若無法讀取需向使用者索取摘要。
- 使用者能說明此次變更的背景、優先順序與交付時程。

## 執行流程

1. **蒐集上下文**
   - 讀取既有需求文件、驗收標準、使用者故事，確認最新版本與版本號。
   - 檢視 `CHANGELOG.md` 或最近的 Git 提交訊息，了解近期調整。
   - 擷取與需求相關的 GitHub Issue、主要留言（若無法存取，請要求使用者提供重點摘要）。
   - 若存在設計或實作文件（`docs/design/`、`docs/impl/` 等），確認可能受影響範圍。

2. **釐清變更範圍（與使用者一問一答）**
   - 變更或新增的功能描述、動機、優先順序。
   - 影響對象（使用者角色、系統邊界、外部整合）。
   - 是否影響非功能需求或 CI/CD 流程。
   - 期望的交付形式（更新文件、建立 Issue、產出 PR 草稿等）。

3. **影響分析**
   - 列出受影響的 EARS 需求條目（新增、修改、刪除），並標註信賴等級 🔵🟡🔴。
   - 為每個功能變更撰寫或調整 GWT（Given-When-Then）驗收描述。
   - 檢查既有 BDD Scenario ID、SDD 契約、TDD 測試矩陣是否受到影響，標記需更新的對照表。
   - 分析非功能需求、設計文件、測試案例是否需要同步更新。
   - 若牽涉新的框架、部署或第三方服務，記錄需重新執行 `tech-stack.prompt.md` 的原因與時程。
   - 評估是否需要新增/調整 CI/CD 工作或檢查。

4. **變更方案草稿**
   - 以 Markdown 匯總：
     - 變更摘要與動機。
     - 更新後的 EARS 需求列表（標示新增、修改、沿用）。
     - 對應的 GWT 驗收表格或清單。
     - 影響分析（文件、程式碼、測試、CI/CD），並指明涉及的 BDD Scenario ID / SDD 契約 / TDD 測試項。
   - 提供 GitHub Issue 建議內容（標題、標籤、內文要點）或直接建議更新既有 Issue。
   - 若需 PR，給出分支命名、Commit Message 模板與主要檔案路徑。

5. **輸出與下一步**
   - 彙整為 Markdown 段落：
     - 專案現況摘要與資料來源。
     - 更新後的 EARS / GWT 清單。
     - 建議建立或更新的 Issue / PR。
     - 建議使用的後續 Prompt（例如 `bdd.prompt.md`、`sdd.prompt.md`、`tdd.prompt.md` 或後續任務拆解 / 實作流程）。
   - 明確指出需人工確認的問題或待決策事項。

## 注意事項

- 任何新的或修改後的需求都必須同時提供 EARS 敘述與 GWT 驗收描述。
- 若資訊不足，請直接向使用者追問；不得自行臆測。
- 請使用繁體中文回應；若 MCP 或其他自動化工具可用，請主動建立／更新 GitHub Issue 留存輸出，無法存取時再請使用者協助。
