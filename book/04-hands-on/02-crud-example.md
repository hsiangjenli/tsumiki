# 4.2 CRUD 操作實作

## 學習目標

透過實作一個簡易的任務管理系統，體驗：
- AITDD 如何應用在多功能整合
- 設計與實作資料管理邏輯
- 接近實務的開發流程
- 與「憑感覺寫程式（Vibe Coding）」的差異

## 專案概觀：記憶體版任務管理

```typescript
interface Task {
  id: string;
  title: string;
  description: string;
  completed: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

需支援：
- **Create**：新增任務
- **Read**：查詢全部／單筆／條件搜尋
- **Update**：更新任務
- **Delete**：刪除任務

相較上一章，新增了：
- 持久層（記憶體陣列）
- 多個方法彼此串聯
- 結合多個驗證規則
- 多樣錯誤處理

## 實作流程

### Step 1：建立 TODO 與分階段

AITDD 經驗顯示：**一次整合 3 個功能** 是實務上較穩定的上限，因此將任務拆成多個階段。

```markdown
# TODO: 任務管理 CRUD

## 階段 1：基礎
- [ ] 定義 Task 介面
- [ ] TaskManager 基本骨架
- [ ] 記憶體儲存

## 階段 2：基本 CRUD（三個功能）
- [ ] createTask
- [ ] getAllTasks
- [ ] getTaskById

## 階段 3：進階功能
- [ ] updateTask
- [ ] deleteTask
- [ ] searchTasks（條件查詢）

## 要求
- TypeScript
- Jest 測試
- 記憶體儲存
- 完整錯誤處理
```

### Step 2：實作階段 1（基礎）

1. 請 AI 依 TODO 產出規格：定義介面、類別、錯誤類型。
2. 再請 AI 依規格撰寫測試（型別檢查、初始化、錯誤類別等）。
3. 執行 Red→Green→Refactor→Validation。

### Step 3：實作階段 2（基本 CRUD）

- 明確描述要實作的行為與約束（例如：createTask 需檢查 title 長度、回傳完整 Task）。
- 提供既有程式碼、規格與測試要求，請 AI 依循流程實作。
- 專注一次 1 個功能，完成後再整合第二、第三個功能。

### Step 4：實作階段 3（進階功能）

- `updateTask`：支援部分更新，需有輸入型別 `TaskUpdateData`。
- `deleteTask`：決定採物理刪除或軟刪除，並在規格中註明。
- `searchTasks`：定義 `TaskFilter`，支援多條件篩選。

### Step 5：整合測試與檢查

- 撰寫整合情境：建立 → 查詢 → 更新 → 搜尋 → 刪除。
- 進行大量資料與效能測試（如一次新增 1000 筆）。
- 檢查測試覆蓋率、程式品質、錯誤處理、可讀性。

## 問題排除建議

| 問題 | 原因 | 解法 |
|------|------|------|
| AI 改動既有程式 | 未明示限制 | 明確說「禁止修改既有程式」並提供對應介面 |
| 測試不完整 | 少了異常／邊界案例 | 檢查清單確保正／異／邊界都有覆蓋 |
| 多功能整合出錯 | 同時實作太多 | 切小步驟，逐項整合並持續執行測試 |

## Prompt 撰寫建議

1. **清楚提供背景**（既有介面、類別、結構）。
2. **明列限制條件**（不得動舊程式、需完整錯誤處理等）。
3. **指定輸出品質**（程式品質、可讀性、文件等）。

可使用範本：
```
請依下列規格實作 createTask：
- 既有程式：...
- 規格：...
- 限制：不得修改既有程式、需 TypeScript 型別、需錯誤處理
- 產出：測試案例、程式碼、使用範例、注意事項
```

## 品質檢查清單

- 功能：所有需求、錯誤處理、邊界條件都通過測試。  
- 技術：遵守 TypeScript 型別、命名規範、結構清楚。  
- 測試：涵蓋正常／異常／邊界，含整合情境。  
- 維護：程式可讀性佳、結構可擴充。

## 收穫

- 感受 AITDD 在多功能整合上的優勢（速度可達傳統的 20～48 倍）。
- 明白結構化流程的重要性，避免「寫到哪算哪」的混亂。
- 累積更進階的 Prompt 與品質檢查技巧。

完成後即可往下一章的 API 開發前進，繼續加深 AITDD 的應用。
