# 4.4 錯誤處理與偵錯

## 學習目標

掌握在 AITDD 開發過程中處理錯誤的技巧：
- 分辨 AI 產生程式碼常見的錯誤類型
- 找出並修正來自 Prompt 的問題
- 建立有效率的偵錯流程
- 知道何時改用手動實作、如何與 AI 協同
- 預防錯誤的最佳實務

## 錯誤分類與對策

1. **Prompt 問題**：指令模糊、需求不清、缺少背景。  
2. **AI 程式碼問題**：邏輯錯誤、與既有程式不相容、效能不足。  
3. **整合問題**：多功能串接時的介面或依賴衝突。  
4. **一般錯誤**：傳統的程式Bug、環境設定、外部服務等。

## 系統化偵錯流程

1. **蒐集資訊**：紀錄完整錯誤訊息、堆疊、環境、輸入、預期行為、實際行為、使用的 Prompt 與程式碼。  
2. **請 AI 協助分析**：將所有資訊提供給 AI，要求指出直接原因、根本原因、可能的 Prompt 問題、修正方向、預防建議。  
3. **逐步驗證假設**：撰寫臨時測試或 log 來確認每個懷疑的點。  
4. **回報結果給 AI**：依分析結果請 AI 產出修正程式碼與額外測試。

## 修正 Prompt 的方法

- 當同類型錯誤重複出現即可懷疑是 Prompt 問題。  
- 請 AI 針對「原 Prompt、期待結果、實際結果」進行診斷。  
- 依建議重新撰寫更具體的 Prompt（提供完整程式碼片段、限制條件、輸出格式）。  
- 重新驗證新 Prompt 能否避免同樣錯誤。

## 何時改用手動實作

評估項目：是否能想像實作步驟、技術複雜度、是否容易描述給 AI。  
若同一錯誤反覆三次以上、Prompt 調整仍無解，或偵錯時間已超過預估實作時間，就可改用手動。  
改用手動時，仍可讓 AI 協助撰寫重複或樣板程式碼，或產生測試與錯誤處理。

## 預防錯誤的實務

- Prompt 要包含完整背景、具體需求、限制與品質要求。  
- 透過清單確認測試涵蓋正常／異常／邊界／整合情境。  
- 紀錄常見錯誤案例與對應 Prompt，持續優化。  
- 撰寫統一的錯誤處理與日誌工具，方便追蹤。  
- 保留 Validation 步驟：檢查規格、型別、覆蓋率、效能與可讀性。

## 總結

本章重點：
- 分類錯誤、蒐集資訊、請 AI 協助分析、逐步驗證、修正並預防。  
- 學會判斷要改動 Prompt 還是改採手動實作。  
- 建立記錄與檢核機制，持續提高品質。

做好錯誤處理與偵錯後，就能在後續章節專注於提示最佳化與流程改善。
