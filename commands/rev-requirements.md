---
description: 從既有程式碼逆向產出需求定義書，並以 EARS 記法整理功能與非功能需求及使用者故事。
---

# rev-requirements

## 目的

分析既有程式碼與資產，逆向推導需求定義書，並以 EARS 記法整理功能／非功能需求與使用者故事。

## 前提

- 可存取目標程式碼
- 具備 `docs/reverse/` 目錄（沒有請建立）
- 建議先完成 `rev-tasks`、`rev-design`

## 執行步驟

1. **辨識與分析功能**
   - 由 UI 元件推導畫面功能
   - 由 API 端點推導商業邏輯
   - 由資料庫結構推測資料需求
   - 由測試程式確認預期行為

2. **推導使用者故事**
   - 推測使用者角色（WHO）
   - 擷取欲達成目標（WHAT）
   - 評估所獲價值（WHY）

3. **依 EARS 記法分類需求**
   - 通常需求（SHALL）
   - 條件式需求（WHEN/IF-THEN）
   - 狀態需求（WHERE）
   - 可選需求（MAY）
   - 限制需求（MUST）

4. **推定非功能需求**
   - 效能：快取、最佳化程式碼
   - 安全：認證／授權、輸入驗證
   - 可用性：錯誤處理、日誌、監控
   - 擴充性與維護性：模組化程度、設定彈性

5. **蒐集證據**
   - 使用 @agent-symbol-searcher 檢索相關檔案
   - 記錄檔案路徑、行號、片段摘要
   - 依需求項目附註來源（🔵／🟡／🔴）

## 輸出檔案

在 `docs/reverse/{要件名}/` 產出：
- `{要件名}-requirements.md`
- `{要件名}-user-stories.md`
- `{要件名}-non-functional.md`

### requirements.md 範例
```markdown
# {要件名} 需求定義書（逆向生成）

## 概要
- 實作版本：...
- 掃描範圍：...
- 產出日期：...

## 功能需求（EARS）
- REQ-001：系統必須 ... 🔵 *src/...*
- REQ-101: WHEN {條件} THEN ... 🟡 *tests/...*

## 非功能需求
- NFR-001: ... 🔵
```

### user-stories.md 範例
```markdown
# {要件名} 使用者故事（逆向推定）

## 角色定義
- 終端使用者：...
- 管理者：...

### 史詩
- Epic1: ...
  - Story1: 身為...我想...因此...
```

### non-functional.md 範例
```markdown
# {要件名} 非功能需求（逆向推定）

## 效能
- ...
```

## 產出注意事項

- 每個需求需標示來源檔案與信賴等級
- 若無法確認來源，需於備註說明
- 保持與 `rev-design`、`rev-tasks` 產出的項目一致

## 完成後建議

- 與利害關係人確認逆向產出的需求
- 若需補齊，將缺漏項目建立為待辦
- 可再執行 `kairo-requirements` 進一步細化
